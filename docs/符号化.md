## 符号化数据生成、微调与评测速查

下面的命令均从仓库根目录 `/home/jfan5/Safety-gen` 运行，默认已 `conda activate llmstl`。

### 1) 生成符号化+原始混合数据集
- 四场景批量生成（blocksworld/ferry/grippers/spanner），输出到 `/jfan5/sft_data/pddl3_augmented_four_scenarios/`（含每域 JSONL + combined.jsonl）：  
  ```bash
  bash shells/augment_four_scenarios_pddl3.sh
  ```
- 脚本默认 1:1 混合“符号化/原始”条目；若需仅符号化，可在 `pddl3/pddl_augment.py` CLI 加 `--no-mix-original` 自行调用。

### 2) 微调（Mistral-7B，4bit QLoRA）
- 仅 Blocksworld（使用符号化 JSONL，若缺 HF 会自动转换）：  
  ```bash
  bash shells/finetune_mistral_7b_blocksworld_augmented.sh
  ```
  - 读入：`/jfan5/sft_data/pddl3_augmented_four_scenarios/blocksworld.jsonl` → `blocksworld.hf`  
  - 输出：`/jfan5/sft_models/mistral_7b/blocksworld_pddl3_augmented`
- 跨域（四场景合并符号化数据集）：  
  ```bash
  bash shells/finetune_mistral_7b_cross_domain_augmented.sh
  ```
  - 读入：`/jfan5/sft_data/pddl3_augmented_four_scenarios/combined.jsonl` → `combined.hf`  
  - 输出：`/jfan5/sft_models/mistral_7b/cross_domain_pddl3_augmented`

### 3) 评测
- 五场景统一评测脚本（blocksworld/ferry/spanner/grippers/delivery，testing_problem50）：  
  ```bash
  bash shells/evaluate_llm_all.sh <模型路径> [one_shot=0|1]
  ```
  例：  
  ```bash
  bash shells/evaluate_llm_all.sh /jfan5/sft_models/mistral_7b/cross_domain_pddl3_augmented 0
  ```
  - 结果保存在 `planning_results/*.json`（文件名含模型名和场景）。
- 单场景可用对应脚本（如 `shells/evaluate_llm_blocksworld.sh` 等），参数同上。***
