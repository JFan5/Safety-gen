#!/bin/bash

#SBATCH --job-name=eval_mistral_multi_pddl3-500_spanner
#SBATCH --partition=gpu
#SBATCH --gres=gpu:1
#SBATCH --cpus-per-task=8
#SBATCH --ntasks=1
#SBATCH --mail-user=jfan5@nd.edu
#SBATCH --mail-type=BEGIN,END,FAIL
#SBATCH --output=job_outputs/evaluate/mistral/multi_scenarios/pddl3_multi-500_spanner_%j.out
#SBATCH --error=job_outputs/evaluate/mistral/multi_scenarios/pddl3_multi-500_spanner_%j.err

set -euo pipefail

# Ensure we are at the repo root so relative paths below work
cd /home/ubuntu/Safety-gen

MODEL_PATH="/jfan5/grpo_models/mistral_7b-spanner-grpo-only-h100_fast"
PROBLEMS_DIR="pddl3/spanner/all_problems3/testing"
DOMAIN_FILE="pddl3/spanner/domain3.pddl"
RESULTS_DIR="planning_results/grpo-spanner/spanner/"
OUTPUT_NAME="spanner_multi_pddl3_50-500.json"

echo "=========================================="
echo "Model path: ${MODEL_PATH}"
echo "Scenario: spanner"
echo "Problems dir: ${PROBLEMS_DIR}"
echo "Domain file: ${DOMAIN_FILE}"
echo "Results dir: ${RESULTS_DIR}"
echo "=========================================="

/home/ubuntu/miniconda3/envs/llmstl/bin/python script/evaluate_llm_solver.py \
  --model "${MODEL_PATH}" \
  --problems-dir "${PROBLEMS_DIR}" \
  --domain-file "${DOMAIN_FILE}" \
  --max-problems 50 \
  --output "${OUTPUT_NAME}" \
  --results-dir "${RESULTS_DIR}"

