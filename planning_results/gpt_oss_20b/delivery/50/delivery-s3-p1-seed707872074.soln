."},
{"role": "user", "content": prompt}
],
"temperature": 0.0,
"max_tokens": 2000,
"top_p": 1.0,
"response_format": {"type": "json"},
"tools": [],
"stream": False
}
headers = {
"Content-Type": "application/json",
"Authorization": f"Bearer {os.getenv('OPENAI_API_KEY')}"
}
try:
response = subprocess.run(
["curl", "-X", "POST", "https://api.openai.com/v1/chat/completions",
"-H", f"Authorization: Bearer {os.getenv('OPENAI_API_KEY')}",
"-H", "Content-Type: application/json"],
input=json.dumps(payload).encode(),
capture_output=True,
check=True,
timeout=60
)
resp_json = json.loads(response.stdout)
plan_text = resp_json["choices"][0]["message"]["content"]
except subprocess.CalledProcessError as e:
print("API request failed:", e.stderr.decode(), file=sys.stderr)
sys.exit(1)
except Exception as ex:
print("Unexpected error:", str(ex), file=sys.stderr)
sys.exit(1)
# The plan_text should contain the lines as specified
plan_lines = [line.strip() for line in plan_text.splitlines() if line.strip()]
# Validate the plan
cell_objects = {"c_0_0","c_0_1","c_0_2","c_1_0","c_1_1","c_1_2","c_2_0","c_2_1","c_2_2"}
package_objects = {"p1"}
truck_objects = {"t1"}
adjacent_map = {
"c_1_0": {"c_