Here's a plan that satisfies all the conditions:

(move b b4)
(pick b1 b3)
(stack b2 b1)
(drop b1 b3)
(stack b1 b2)
(unstack b1 b2)
(unstack b3 b4)
(stack b3 b1)
(pick b2 b3)

This plan is grounded, totally ordered, and satisfies all the conditions. It should be produced as the output.